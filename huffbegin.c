#include "header.h"

int main()
{
    node *list = create_empty_node();
    pq *priority_queue = create_pq();
    node *bt = create_empty_node();
    queue *fila = create_queue();
    hash_table *ht = create_hash_table();
    unsigned char characterfirst;
    FILE *file = fopen("oi.txt","rb");
    while(1)
    {
        characterfirst = fgetc(file);
        if (feof(file))
        {
            break;
        }
        list = add(list,characterfirst);
    }
    node *temp = list;
    while(temp != NULL)
    {
        enqueue_pq(priority_queue,temp);
        temp = temp->next;
    }
    while(priority_queue->head->next!= NULL)
    {
        node *first = dequeue_pq(priority_queue);
        node *second = dequeue_pq(priority_queue);
        merge(bt,first,second,priority_queue);
    }
    backtrack(priority_queue->head,fila,ht);
    print_hash_table(ht);
    rewind(file);
    unsigned char item = 0;
    byte *new_byte = create_byte(item);
    int i,lixo;
    int size = count_tree(priority_queue->head);
    FILE *new = fopen("compressed.txt","wb");
    fprintf(new,"%c%c",0,0);
    print_tree_file(priority_queue->head,new);
    while(!feof(file))
    {
        set_bit(new_byte,new_byte->position,file,ht,new);
        if (feof(file))
        {
            fprintf(new,"%d",new_byte->item);
            lixo = new_byte->position+1;
            print_byte_as_bits(lixo);
            print_byte_as_bits(size);
            fseek(new,0,SEEK_SET);
            fprintf(new,"%d",lixo);
            fprintf(new,"%d",size);
            //printf("%d\n",lixo);
            break;
        }
    }
    fclose(file);
    return 0;
}


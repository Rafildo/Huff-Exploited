#include "header.h"

int main()
{
	node *list = create_empty_node();
	pq *priority_queue = create_pq();
	node *bt = create_empty_node();
	queue *fila = create_queue();
	hash_table *ht = create_hash_table();

	unsigned char characterfirst;
	FILE *file = fopen("oi.txt","rb");
	while(1)
	{
		characterfirst = fgetc(file);
		if (feof(file)) 
		{
			break;
		}
		list = add(list,characterfirst);
	}
	node *temp = list;
	while(temp != NULL)
	{
		enqueue_pq(priority_queue,temp);
		temp = temp->next;
	}
	while(priority_queue->head->next!= NULL)
	{
		node *first = dequeue_pq(priority_queue);
		node *second = dequeue_pq(priority_queue);
		merge(bt,first,second,priority_queue);
	}
	//print_tree(priority_queue->head);
	//printf("\n");
	backtrack(priority_queue->head,fila,ht);
	//print_hash_table(ht);
	rewind(file);
	unsigned char byte = 0;
	int i;
	FILE *new = fopen("compressed.txt","w");
	while(1)
	{
		for (i = 7; i >= 0; --i)
		{
			byte = set_bit(byte,file,i,ht);
		}
		fprintf(new, "%c",byte);
		byte = 0;
	}
	//print_byte_as_bits(byte);
	//printf("%c",byte);
	//print_bit(string,file);
	fclose(file);
	return 0;
}

